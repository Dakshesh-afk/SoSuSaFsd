@page "/admin"
@rendermode InteractiveServer

<PageTitle>SoSuSa - Admin Dashboard</PageTitle>

<style>
    /* Force scrollbar to prevent layout shift */
    html {
        overflow-y: scroll;
    }

    /* Custom Logo Style */
    .logo-icon {
        width: 40px;
        height: 40px;
        background-color: #333;
        color: white;
        border-radius: 50% 50% 50% 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 2px 2px 0px #999;
    }

    /* Nav Link Styles */
    .nav-link {
        position: relative;
        padding-bottom: 5px;
        cursor: pointer;
        font-weight: 600;
        font-size: 16px;
        color: #555; /* Default gray */
        text-decoration: none;
        border-bottom: 2px solid transparent;
    }

        .nav-link:hover {
            color: #000;
        }

        .nav-link.active {
            color: #000 !important;
            border-bottom: 2px solid #333;
        }

    /* Helper to hide elements programmatically */
    .d-none {
        display: none !important;
    }
</style>

<header class="bg-white border-b-2 border-sosusa-black sticky top-0 z-50 py-3">
    <div class="w-[95%] mx-auto flex items-center justify-between">

        <div class="flex items-center cursor-pointer" onclick="switchTab('dashboard')">
            <div class="logo-icon mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12" /></svg>
            </div>
            <div class="flex flex-col">
                <span class="text-2xl font-bold text-sosusa-black tracking-tight leading-none">SoSuSa</span>
                <span class="text-[10px] uppercase font-bold text-gray-500 tracking-widest leading-none mt-0.5">Dashboard</span>
            </div>
        </div>

        <nav class="flex gap-8" id="main-nav">
            <a onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-link active">Dashboard</a>
            <a onclick="switchTab('reports')" id="nav-reports" class="nav-link flex items-center gap-2">
                Moderation <span id="nav-badge-reports" class="d-none bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded-full -mt-1">0</span>
            </a>
            <a onclick="switchTab('verifications')" id="nav-verifications" class="nav-link">Access</a>
            <a onclick="switchTab('categories')" id="nav-categories" class="nav-link">Categories</a>
            <a onclick="switchTab('users')" id="nav-users" class="nav-link">Users</a>
        </nav>

        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3">
                <div class="text-right hidden sm:block">
                    <p class="text-sm font-bold text-sosusa-black leading-tight">Admin User</p>
                    <p class="text-[10px] text-gray-500 uppercase tracking-wider font-semibold">Admin</p>
                </div>
                <div class="w-10 h-10 rounded-full bg-sosusa-black text-white flex items-center justify-center font-bold text-sm border-2 border-sosusa-border cursor-pointer shadow-sm">AU</div>
            </div>
            <a href="/" class="text-gray-400 hover:text-red-600 transition-colors" title="Exit to App">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" x2="9" y1="12" y2="12" /></svg>
            </a>
        </div>
    </div>
</header>

<main class="w-[95%] mx-auto py-8">
    <div class="mb-8">
        <h2 id="page-title" class="text-3xl font-extrabold text-sosusa-black capitalize">Dashboard</h2>
        <p id="page-desc" class="text-gray-500 mt-1 font-medium">Manage your platform's content and settings.</p>
    </div>

    <div id="view-container">
    </div>
</main>

<script>
    // --- 1. ICON DEFINITIONS (SVG Strings) ---
    const ICONS = {
        users: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>`,
        alert: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>`,
        fileCheck: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m9 15 2 2 4-4"/></svg>`,
        hash: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></svg>`,
        lock: `<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>`,
        unlock: `<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>`,
        trash: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>`,
        check: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
        x: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`
    };

    // --- 2. DATA ---
    var activeTab = 'dashboard';

    var categories = [
        { CategoryID: 1, CategoryName: 'News', CategoryIsRestricted: true, PostCount: 1240 },
        { CategoryID: 2, CategoryName: 'TpNews', CategoryIsRestricted: true, PostCount: 850 },
        { CategoryID: 3, CategoryName: 'Sports', CategoryIsRestricted: true, PostCount: 543 },
        { CategoryID: 4, CategoryName: 'General', CategoryIsRestricted: false, PostCount: 2100 },
        { CategoryID: 5, CategoryName: 'CampusLife', CategoryIsRestricted: false, PostCount: 3200 },
        { CategoryID: 6, CategoryName: 'Events', CategoryIsRestricted: false, PostCount: 150 }
    ];

    // NOTE: '@@' is used to escape the Razor syntax so C# ignores it
    var users = [
        { UserID: 1, Username: '@@testuser1', DisplayName: 'Testuser', Role: 'User', IsActive: true, ProfileImage: 'TU', VerifiedCategories: ['CampusLife'] },
        { UserID: 2, Username: '@@straitstimes', DisplayName: 'Straits Times', Role: 'User', IsActive: true, ProfileImage: 'ST', VerifiedCategories: ['News'] },
        { UserID: 3, Username: '@@tp_admin', DisplayName: 'TP Admin', Role: 'Admin', IsActive: true, ProfileImage: 'TP', VerifiedCategories: ['TpNews'] },
        { UserID: 4, Username: '@@newstudent_01', DisplayName: 'NewStudent_01', Role: 'User', IsActive: true, ProfileImage: 'NS', VerifiedCategories: [] },
        { UserID: 5, Username: '@@crypto_king', DisplayName: 'Crypto King', Role: 'User', IsActive: true, ProfileImage: 'CK', VerifiedCategories: [] }
    ];

    var reports = [
        { ReportID: 1, UserID: 5, Reason: 'Spam', Status: 'Pending', DateCreated: '2023-11-12', PostID: 102 },
        { ReportID: 2, UserID: 4, Reason: 'Misinformation', Status: 'Pending', DateCreated: '2023-11-13', PostID: 103 },
        { ReportID: 3, UserID: 1, Reason: 'Harassment', Status: 'Resolved', DateCreated: '2023-10-01', PostID: null }
    ];

    var verifications = [
        { RequestID: 1, UserID: 4, CategoryID: 3, Reason: 'I am the captain of the football team.', Document: 'team_roster.pdf', VRStatus: 'Pending' },
        { RequestID: 2, UserID: 5, CategoryID: 2, Reason: 'I sell merch on campus.', Document: 'business_license.pdf', VRStatus: 'Rejected' }
    ];

    // --- 3. INIT & NAVIGATION ---
    function init() { renderApp(); }

    function switchTab(tabName) {
        activeTab = tabName;
        renderApp();
    }

    function renderApp() {
        updateHeader();
        const container = document.getElementById('view-container');
        if (!container) return;

        if (activeTab === 'dashboard') container.innerHTML = renderDashboard();
        else if (activeTab === 'users') container.innerHTML = renderUsers();
        else if (activeTab === 'reports') container.innerHTML = renderReports();
        else if (activeTab === 'categories') container.innerHTML = renderCategories();
        else if (activeTab === 'verifications') container.innerHTML = renderVerifications();
    }

    function updateHeader() {
        // Reset all links
        document.querySelectorAll('.nav-link').forEach(el => {
            el.classList.remove('active');
        });

        // Highlight active link
        const activeNav = document.getElementById('nav-' + activeTab);
        if(activeNav) {
            activeNav.classList.add('active');
        }

        // Update Report Badge
        const pendingCount = reports.filter(r => r.Status === 'Pending').length;
        const badge = document.getElementById('nav-badge-reports');
        if (badge) {
            if (pendingCount > 0) {
                badge.innerText = pendingCount;
                badge.classList.remove('d-none'); // Show
            } else {
                badge.classList.add('d-none'); // Hide
            }
        }

        // Update Title/Desc based on tab
        const titles = {
            dashboard: 'Dashboard',
            users: 'User Management',
            reports: 'Reported Content',
            verifications: 'Category Access Requests',
            categories: 'Category Management'
        };
        const descs = {
            dashboard: "Manage your platform's content and settings.",
            users: "Manage your platform's User Management content and settings.",
            reports: "Manage your platform's Reported Content content and settings.",
            verifications: "Manage user access permissions for restricted categories.",
            categories: "Lock, unlock, and delete discussion topics."
        };

        document.getElementById('page-title').innerText = titles[activeTab] || 'Dashboard';
        document.getElementById('page-desc').innerText = descs[activeTab] || '';
    }

    // --- 4. RENDER FUNCTIONS ---

    // === DASHBOARD VIEW ===
    function renderDashboard() {
        const pendingReports = reports.filter(r => r.Status === 'Pending');
        const pendingVerifications = verifications.filter(v => v.VRStatus === 'Pending');

        return `
            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    ${renderStatCard('Total Users', users.length, ICONS.users, 'bg-blue-600')}
                    ${renderStatCard('Pending Reports', pendingReports.length, ICONS.alert, 'bg-amber-500')}
                    ${renderStatCard('Category Requests', pendingVerifications.length, ICONS.fileCheck, 'bg-green-600')}
                    ${renderStatCard('Categories', categories.length, ICONS.hash, 'bg-purple-600')}
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg border border-sosusa-border shadow-sm flex flex-col h-96">
                        <div class="p-4 border-b border-sosusa-border flex justify-between items-center bg-white sticky top-0 z-10 rounded-t-lg">
                            <h3 class="font-bold text-sosusa-black flex items-center gap-2">
                                <div class="text-red-500 w-5 h-5">${ICONS.alert}</div> Recent Reports
                            </h3>
                            <button onclick="switchTab('reports')" class="text-sm font-medium text-sosusa-gray hover:text-black hover:underline">View All</button>
                        </div>
                        <div class="overflow-y-auto flex-1 p-2">
                            ${pendingReports.length > 0 ? pendingReports.map(r => `
                                <div class="p-4 mb-2 bg-white rounded border border-sosusa-border hover:shadow-md transition-all">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="text-xs font-bold text-red-600 uppercase tracking-wider">${r.Reason}</span>
                                        <span class="text-xs text-gray-400">${r.DateCreated}</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">Post ID: ${r.PostID}</p>
                                    <div class="flex gap-2">
                                        <button onclick="alert('Dismissed')" class="text-xs px-3 py-1.5 rounded border border-gray-300 text-gray-600 hover:bg-gray-50 font-semibold">Dismiss</button>
                                        <button onclick="alert('Deleted')" class="text-xs px-3 py-1.5 rounded bg-sosusa-black text-white hover:bg-gray-800 font-semibold">Delete</button>
                                    </div>
                                </div>
                            `).join('') : `<div class="h-full flex flex-col items-center justify-center text-gray-400"><p class="text-sm">No pending reports</p></div>`}
                        </div>
                    </div>

                    <div class="bg-white rounded-lg border border-sosusa-border shadow-sm flex flex-col h-96">
                        <div class="p-4 border-b border-sosusa-border flex justify-between items-center bg-white sticky top-0 z-10 rounded-t-lg">
                            <h3 class="font-bold text-sosusa-black flex items-center gap-2">
                                <div class="text-indigo-500 w-5 h-5">${ICONS.fileCheck}</div> Verifications
                            </h3>
                            <button onclick="switchTab('verifications')" class="text-sm font-medium text-sosusa-gray hover:text-black hover:underline">View All</button>
                        </div>
                        <div class="overflow-y-auto flex-1 p-2">
                            ${pendingVerifications.length > 0 ? pendingVerifications.map(req => {
                                const user = users.find(u => u.UserID === req.UserID);
                                const cat = categories.find(c => c.CategoryID === req.CategoryID);
                                return `
                                    <div class="p-4 mb-2 bg-white rounded border border-sosusa-border hover:shadow-md transition-all">
                                        <div class="flex items-center gap-3 mb-3">
                                            <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-bold text-gray-600">${user?.ProfileImage}</div>
                                            <div class="overflow-hidden">
                                                <p class="text-sm font-bold text-sosusa-black truncate">${user?.DisplayName}</p>
                                                <p class="text-xs text-indigo-600 font-medium flex items-center gap-1">
                                                    <span class="w-3 h-3">${ICONS.lock}</span> #${cat?.CategoryName || 'Unknown'}
                                                </p>
                                            </div>
                                        </div>
                                        <div class="flex gap-2">
                                            <button class="flex-1 py-1.5 text-xs font-bold uppercase bg-sosusa-black text-white rounded-md hover:bg-gray-800">Grant</button>
                                            <button class="flex-1 py-1.5 text-xs font-bold uppercase border border-gray-300 bg-white text-gray-600 rounded-md hover:bg-gray-50">Deny</button>
                                        </div>
                                    </div>
                                `;
                            }).join('') : `<div class="h-full flex flex-col items-center justify-center text-gray-400"><p class="text-sm">All requests handled</p></div>`}
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function renderStatCard(title, value, iconHtml, colorClass) {
        return `
            <div class="bg-white p-5 rounded-lg border border-sosusa-border shadow-sm flex items-start justify-between">
                <div>
                    <p class="text-sosusa-gray text-xs font-bold uppercase tracking-wide mb-1">${title}</p>
                    <h3 class="text-2xl font-bold text-sosusa-black">${value}</h3>
                </div>
                <div class="p-2 rounded-md ${colorClass} bg-opacity-90 text-white w-9 h-9 flex items-center justify-center">
                    <div style="width:20px; height:20px;">${iconHtml}</div>
                </div>
            </div>
        `;
    }

    // === USERS VIEW ===
    function renderUsers() {
        return `
            <div class="bg-white rounded-lg border border-sosusa-border shadow-sm overflow-hidden">
                <div class="p-4 border-b border-sosusa-border">
                    <h3 class="font-bold text-sosusa-black">User Management</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm text-gray-600">
                        <thead class="bg-sosusa-light text-sosusa-black font-bold uppercase text-xs border-b border-sosusa-border">
                            <tr><th class="px-6 py-3">User</th><th class="px-6 py-3">Role</th><th class="px-6 py-3">Status</th><th class="px-6 py-3">Verified Categories</th><th class="px-6 py-3">Actions</th></tr>
                        </thead>
                        <tbody>
                            ${users.map(u => `
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold">${u.ProfileImage}</div>
                                            <div><div class="font-bold text-sosusa-black">${u.DisplayName}</div><div class="text-xs text-gray-400">${u.Username}</div></div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4"><span class="px-2 py-0.5 border rounded uppercase text-[11px] font-bold ${u.Role === 'Admin' ? 'bg-black text-white border-black' : 'bg-white text-gray-600'}">${u.Role}</span></td>
                                    <td class="px-6 py-4"><span class="px-2 py-0.5 rounded text-[11px] font-bold uppercase ${u.IsActive ? 'bg-green-50 text-green-700 border border-green-200' : 'bg-red-50 text-red-700 border border-red-200'}">${u.IsActive ? 'Active' : 'Banned'}</span></td>
                                    <td class="px-6 py-4">
                                        <div class="flex gap-1">
                                            ${u.VerifiedCategories.length > 0 ? u.VerifiedCategories.map(c => `<span class="bg-gray-100 border px-2 py-0.5 rounded-full text-[10px] font-bold flex items-center gap-1">#${c} <span class="text-blue-500">${ICONS.check}</span></span>`).join('') : '<span class="text-gray-300 text-xs">-</span>'}
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 flex gap-2">
                                        <select class="text-xs border rounded p-1"><option>24 Hours</option><option>Permanent</option></select>
                                        <button class="bg-red-600 text-white text-[10px] font-bold px-3 py-1.5 rounded uppercase hover:bg-red-700">Ban</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
    }

    // === REPORTS VIEW ===
    function renderReports() {
        return `
            <div class="bg-white rounded-lg border border-sosusa-border shadow-sm overflow-hidden p-6">
                 <div class="flex justify-between mb-4">
                    <h3 class="font-bold text-lg">Reported Content</h3>
                    <button class="border px-3 py-1 rounded text-xs font-bold uppercase hover:bg-gray-50">Filter</button>
                </div>
                <div class="grid gap-4">
                    ${reports.map(r => `
                        <div class="p-4 border border-sosusa-border rounded bg-white hover:bg-gray-50">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase ${r.Status === 'Pending' ? 'bg-amber-100 text-amber-800' : 'bg-green-100 text-green-800'}">${r.Status}</span>
                                    <span class="font-bold text-gray-700">${r.Reason}</span>
                                </div>
                                <span class="text-xs text-gray-400">${r.DateCreated}</span>
                            </div>
                            <p class="text-sm text-gray-600 italic bg-gray-50 p-2 rounded mb-3">Content Preview Unavailable</p>
                            <div class="flex justify-end gap-2">
                                <button class="text-[10px] font-bold uppercase px-3 py-1.5 rounded border border-gray-300 hover:bg-gray-100">Dismiss</button>
                                <button class="text-[10px] font-bold uppercase px-3 py-1.5 rounded bg-sosusa-black text-white hover:bg-gray-800">Delete Content</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    // === CATEGORIES VIEW ===
    function renderCategories() {
        return `
            <div class="bg-white rounded-lg border border-sosusa-border shadow-sm overflow-hidden">
                <div class="p-4 border-b border-sosusa-border flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-sosusa-black">Category Management</h3>
                        <p class="text-xs text-gray-500">Lock categories to require verification.</p>
                    </div>
                    <button class="bg-sosusa-black text-white text-xs font-bold uppercase px-4 py-2 rounded-full hover:bg-gray-800">+ Create</button>
                </div>
                <table class="w-full text-left text-sm text-gray-600">
                    <thead class="bg-sosusa-light text-sosusa-black font-bold uppercase text-xs border-b border-sosusa-border">
                        <tr><th class="px-6 py-3">Category Name</th><th class="px-6 py-3">Access Level</th><th class="px-6 py-3">Total Posts</th><th class="px-6 py-3">Actions</th></tr>
                    </thead>
                    <tbody>
                        ${categories.map(c => `
                            <tr class="border-b hover:bg-gray-50">
                                <td class="px-6 py-4 font-bold flex items-center gap-2"><div class="w-6 h-6 bg-gray-100 rounded flex items-center justify-center text-gray-500">${ICONS.hash}</div> ${c.CategoryName}</td>
                                <td class="px-6 py-4"><span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase ${c.CategoryIsRestricted ? 'bg-red-50 text-red-600 border border-red-200' : 'bg-green-50 text-green-600 border border-green-200'}">${c.CategoryIsRestricted ? 'Restricted' : 'Open'}</span></td>
                                <td class="px-6 py-4 font-mono">${c.PostCount}</td>
                                <td class="px-6 py-4">
                                    <div class="flex gap-2">
                                        <button class="flex items-center gap-1 text-[10px] font-bold uppercase border px-2 py-1 rounded hover:bg-gray-50">
                                            <span class="w-3 h-3">${c.CategoryIsRestricted ? ICONS.lock : ICONS.unlock}</span> ${c.CategoryIsRestricted ? 'Unlock' : 'Lock'}
                                        </button>
                                        <button class="p-1 text-gray-400 hover:text-red-600">${ICONS.trash}</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }

    // === VERIFICATIONS VIEW ===
    function renderVerifications() {
        return `
            <div class="bg-white rounded-lg border border-sosusa-border shadow-sm overflow-hidden">
                 <div class="p-4 border-b border-sosusa-border">
                    <h3 class="font-bold text-lg">Category Access Requests</h3>
                    <p class="text-xs text-gray-500">Review applications for permission to post in restricted categories.</p>
                </div>
                <div class="divide-y divide-gray-200">
                    ${verifications.map(v => {
                        const user = users.find(u => u.UserID === v.UserID);
                        const cat = categories.find(c => c.CategoryID === v.CategoryID);
                        return `
                        <div class="p-6 flex flex-col md:flex-row gap-6">
                            <div class="flex items-center gap-3 w-48">
                                <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-bold text-gray-600">${user ? user.ProfileImage : '??'}</div>
                                <div>
                                    <div class="font-bold text-sm">${user ? user.DisplayName : 'Unknown'}</div>
                                    <div class="text-xs text-gray-500">${user ? user.Username : ''}</div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-[10px] font-bold text-gray-400 uppercase">Target Category</span>
                                    <span class="bg-indigo-50 text-indigo-700 border border-indigo-200 px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1"><span class="w-3 h-3">${ICONS.lock}</span> #${cat ? cat.CategoryName : 'Unknown'}</span>
                                </div>
                                <div class="mb-2">
                                    <span class="text-[10px] font-bold text-gray-400 uppercase">Reason Provided</span>
                                    <div class="p-3 border rounded bg-gray-50 text-sm italic text-gray-700 mt-1">"${v.Reason}"</div>
                                </div>
                                <div class="flex items-center gap-1 text-xs text-blue-600">
                                    <span class="w-4 h-4">${ICONS.fileCheck}</span> <span class="underline cursor-pointer">${v.Document}</span>
                                </div>
                            </div>
                            <div class="flex flex-col gap-2 justify-center w-32">
                                ${v.VRStatus === 'Pending' ? `
                                    <button class="bg-sosusa-black text-white text-xs font-bold uppercase py-2 rounded hover:bg-gray-800">Grant</button>
                                    <button class="border border-gray-300 text-gray-600 text-xs font-bold uppercase py-2 rounded hover:bg-gray-50">Deny</button>
                                ` : `
                                    <div class="text-center text-xs font-bold uppercase p-2 border rounded ${v.VRStatus === 'Rejected' ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}">${v.VRStatus}</div>
                                `}
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    }

    // Init with delay to wait for Blazor DOM
    setTimeout(init, 200);
</script>