@page "/profile/{username}"
@rendermode InteractiveServer
@inherits ProfileBase
@using SoSuSaFsd.Components.Pages.ProfileComponents

<PageTitle>@State.PageTitle</PageTitle>
<link rel="stylesheet" href="/styles/category-details.css" />

<header class="site-header">
    <div class="header-container">
        <div class="logo-area" onclick="location.href='/'">
            <div class="logo-icon"><i class="fas fa-check"></i></div>
            <span class="logo-text">SoSuSa</span>
        </div>
        <button class="login-btn" onclick="location.href='/'">Back Home</button>
    </div>
</header>

<div class="main-layout">
    <main class="feed-area">
        @if (State.ProfileUser == null)
        {
            <div class="loading-state">
                @if (State.IsLoading)
                {
                    <span>Loading...</span>
                }
                else
                {
                    <span>User not found.</span>
                }
            </div>
        }
        else
        {
            <ProfileHeader 
                ProfileImage="@State.ProfileUser.ProfileImage"
                DisplayName="@(State.ProfileUser.DisplayName ?? State.ProfileUser.UserName)"
                Username="@State.ProfileUser.UserName"
                PostCount="@State.UserPosts.Count"
                FollowerCount="@State.FollowerCount"
                IsReportDisabled="@State.IsReportDisabled"
                ReportStatusMessage="@State.ReportStatusMessage"
                ErrorMessage="@State.ErrorMessage"
                OnReportUser="@ReportUserAsync" />

            <hr />

            <ProfilePostsFeed 
                Posts="@State.UserPosts"
                ProfileUserName="@(State.ProfileUser.DisplayName ?? State.ProfileUser.UserName)"
                CurrentUser="@State.CurrentUser"
                ShowComments="@State.ShowComments"
                PostComments="@State.PostComments"
                CommentDrafts="@State.CommentDrafts"
                CarouselIndices="@State.CarouselIndices"
                ActiveReplyBoxes="@State.ActiveReplyBoxes"
                ReplyDrafts="@State.ReplyDrafts"
                OnLike="@((postId) => ToggleLike(postId))"
                OnComment="@((postId) => ToggleComments(postId))"
                OnReport="@OpenReportModal"
                OnUpdateDraft="@((args) => UpdateCommentDraft(args.PostId, args.Content))"
                OnSubmitComment="@SubmitComment"
                OnCarouselChange="@((args) => State.CarouselIndices[args.PostId] = args.Index)"
                OnToggleReply="@ToggleReplyBox"
                OnUpdateReplyDraft="@((args) => UpdateReplyDraft(args.ParentCommentId, args.Content))"
                OnSubmitReply="@((args) => SubmitReply(args.PostId, args.ParentCommentId))" />
        }
    </main>
</div>