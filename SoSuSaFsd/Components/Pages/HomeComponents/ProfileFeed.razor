@using SoSuSaFsd.Domain
@using SoSuSaFsd.Components.Common

@* ProfileFeed - User's own posts *@

<h1 class="page-title">My Posts</h1>
<hr />

@if (UserPosts != null && UserPosts.Any())
{
    @foreach (var post in UserPosts)
    {
        <PostCard Post="post" 
                  CurrentUser="CurrentUser" 
                  OnLike="OnLike" 
                  OnComment="OnComment"
                  OnReport="OnReport" 
                  ShowComments="ShowComments" 
                  PostComments="PostComments"
                  CommentDrafts="CommentDrafts" 
                  OnUpdateDraft="OnUpdateDraft"
                  OnSubmitComment="OnSubmitComment" 
                  CarouselIndices="CarouselIndices" 
                  OnCarouselChange="OnCarouselChange"
                  ActiveReplyBoxes="ActiveReplyBoxes" 
                  ReplyDrafts="ReplyDrafts" 
                  OnToggleReply="OnToggleReply"
                  OnUpdateReplyDraft="OnUpdateReplyDraft" 
                  OnSubmitReply="OnSubmitReply" />
    }
}
else
{
    <p style="text-align:center; color:#666;">No posts yet.</p>
}

@code {
    /// <summary>
    /// List of user's posts to display
    /// </summary>
    [Parameter]
    public List<Posts> UserPosts { get; set; } = new();

    /// <summary>
    /// Current logged-in user
    /// </summary>
    [Parameter]
    public Users? CurrentUser { get; set; }

    /// <summary>
    /// Dictionary tracking which posts have comments expanded
    /// </summary>
    [Parameter]
    public Dictionary<int, bool> ShowComments { get; set; } = new();

    /// <summary>
    /// Dictionary of loaded comments for each post
    /// </summary>
    [Parameter]
    public Dictionary<int, List<Comments>> PostComments { get; set; } = new();

    /// <summary>
    /// Dictionary of comment drafts for each post
    /// </summary>
    [Parameter]
    public Dictionary<int, string> CommentDrafts { get; set; } = new();

    /// <summary>
    /// Dictionary of carousel indices for posts with media
    /// </summary>
    [Parameter]
    public Dictionary<int, int> CarouselIndices { get; set; } = new();

    /// <summary>
    /// Dictionary tracking active reply boxes
    /// </summary>
    [Parameter]
    public Dictionary<int, bool> ActiveReplyBoxes { get; set; } = new();

    /// <summary>
    /// Dictionary of reply drafts
    /// </summary>
    [Parameter]
    public Dictionary<int, string> ReplyDrafts { get; set; } = new();

    /// <summary>
    /// Callback when user likes a post
    /// </summary>
    [Parameter]
    public EventCallback<int> OnLike { get; set; }

    /// <summary>
    /// Callback when user toggles comments
    /// </summary>
    [Parameter]
    public EventCallback<int> OnComment { get; set; }

    /// <summary>
    /// Callback when user reports a post
    /// </summary>
    [Parameter]
    public EventCallback<int> OnReport { get; set; }

    /// <summary>
    /// Callback when user updates a comment draft
    /// </summary>
    [Parameter]
    public EventCallback<PostCard.CommentDraftEventArgs> OnUpdateDraft { get; set; }

    /// <summary>
    /// Callback when user submits a comment
    /// </summary>
    [Parameter]
    public EventCallback<int> OnSubmitComment { get; set; }

    /// <summary>
    /// Callback when carousel index changes
    /// </summary>
    [Parameter]
    public EventCallback<PostCard.CarouselEventArgs> OnCarouselChange { get; set; }

    /// <summary>
    /// Callback when user toggles reply box
    /// </summary>
    [Parameter]
    public EventCallback<int> OnToggleReply { get; set; }

    /// <summary>
    /// Callback when user updates a reply draft
    /// </summary>
    [Parameter]
    public EventCallback<PostCard.ReplyDraftEventArgs> OnUpdateReplyDraft { get; set; }

    /// <summary>
    /// Callback when user submits a reply
    /// </summary>
    [Parameter]
    public EventCallback<PostCard.SubmitReplyEventArgs> OnSubmitReply { get; set; }
}
