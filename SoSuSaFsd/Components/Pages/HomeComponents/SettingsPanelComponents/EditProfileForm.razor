@using SoSuSaFsd.Domain
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Authorization

@* EditProfileForm - Profile editing form *@

<AuthorizeView Context="authContext">
    <Authorized>
        <div id="settings-form-profile" class="settings-content active">
            <h1 class="page-title">Edit Profile</h1>
            <hr />
            <div class="post-card" style="padding: 20px;">
                @if (CurrentUser != null)
                {
                    <form @onsubmit="OnProfileUpdate" @onsubmit:preventDefault>
                        <div class="settings-form-group" style="display:flex; flex-direction:column; align-items:center;">
                            @* Profile Avatar *@
                            <div class="profile-avatar-large" 
                                 style="background-image: url('@(CurrentUser.ProfileImage ?? "")'); margin: 0 auto 15px; width: 120px; height: 120px; background-size: cover; background-position: center; border-radius: 50%;"></div>
                            <label class="login-btn secondary" 
                                   style="cursor: pointer; font-weight:normal; font-size:13px; padding: 5px 15px; position: relative; overflow: hidden;">
                                Change Photo
                                <InputFile OnChange="OnImageChange" 
                                           accept=".jpg,.jpeg,.png" 
                                           style="position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer;" />
                            </label>
                        </div>
                        <div class="settings-form-group">
                            <label>Display Name</label>
                            <input type="text" @bind="CurrentUser.DisplayName" />
                        </div>
                        <div class="settings-form-group">
                            <label>Bio</label>
                            <textarea rows="4" @bind="CurrentUser.Bio"></textarea>
                        </div>
                        @if (!string.IsNullOrEmpty(StatusMessage))
                        {
                            <div class="@(StatusMessage.Contains("Error") ? "error-msg" : "success-msg")">@StatusMessage</div>
                        }
                        <button type="submit" class="login-btn">Save Changes</button>
                    </form>
                }
            </div>
        </div>
    </Authorized>
    <NotAuthorized>
        <div id="settings-form-profile" class="settings-content active">
            <h1 class="page-title">Edit Profile</h1>
            <hr />
            <div class="post-card" style="padding: 20px; text-align: center;">
                <i class="fas fa-user-circle" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                <p style="color: #666;">Please login to edit your profile.</p>
            </div>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    [Parameter] public Users? CurrentUser { get; set; }
    [Parameter] public string StatusMessage { get; set; } = string.Empty;
    [Parameter] public EventCallback OnProfileUpdate { get; set; }
    [Parameter] public EventCallback<InputFileChangeEventArgs> OnImageChange { get; set; }
}
