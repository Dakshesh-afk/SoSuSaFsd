@using Microsoft.AspNetCore.Components.Forms
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Authorization

@* ChangePasswordForm - Password change form *@

<AuthorizeView Context="authContext">
    <Authorized>
        <div id="settings-form-password" class="settings-content hidden">
            <h1 class="page-title">Change Password</h1>
            <hr />
            <div class="post-card" style="padding: 20px;">
                <EditForm Model="PasswordModel" OnValidSubmit="OnPasswordChange" FormName="passwordChangeForm">
                    <DataAnnotationsValidator />
                    <div class="settings-form-group">
                        <label>Current Password</label>
                        <InputText type="password" @bind-Value="PasswordModel.OldPassword" />
                        <ValidationMessage For="() => PasswordModel.OldPassword" class="text-danger" />
                    </div>
                    <div class="settings-form-group">
                        <label>New Password</label>
                        <InputText type="password" @bind-Value="PasswordModel.NewPassword" />
                        <ValidationMessage For="() => PasswordModel.NewPassword" class="text-danger" />
                    </div>
                    <div class="settings-form-group">
                        <label>Confirm New Password</label>
                        <InputText type="password" @bind-Value="PasswordModel.ConfirmPassword" />
                        <ValidationMessage For="() => PasswordModel.ConfirmPassword" class="text-danger" />
                    </div>
                    @if (!string.IsNullOrEmpty(PasswordMessage))
                    {
                        <div class="@(IsPasswordSuccess ? "success-msg" : "error-msg")">@PasswordMessage</div>
                    }
                    <button type="submit" class="login-btn">Update Password</button>
                </EditForm>
            </div>
        </div>
    </Authorized>
    <NotAuthorized>
        <div id="settings-form-password" class="settings-content hidden">
            <h1 class="page-title">Change Password</h1>
            <hr />
            <div class="post-card" style="padding: 20px; text-align: center;">
                <i class="fas fa-lock" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                <p style="color: #666;">Please login to change your password.</p>
            </div>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    [Parameter] public PasswordChangeModel PasswordModel { get; set; } = new();
    [Parameter] public string PasswordMessage { get; set; } = string.Empty;
    [Parameter] public bool IsPasswordSuccess { get; set; }
    [Parameter] public EventCallback OnPasswordChange { get; set; }

    public class PasswordChangeModel
    {
        [Required]
        public string OldPassword { get; set; } = "";

        [Required]
        [StringLength(100, MinimumLength = 6)]
        public string NewPassword { get; set; } = "";

        [Compare("NewPassword")]
        public string ConfirmPassword { get; set; } = "";
    }
}
