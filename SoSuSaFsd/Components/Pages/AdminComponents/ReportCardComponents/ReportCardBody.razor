@using SoSuSaFsd.Domain

@* ReportCardBody - List of report reasons *@

@{
    var reportCount = Group.Count();
}

<div class="report-body">
    <div class="flex flex-col gap-2">
        @foreach (var item in Group.Take(2))
        {
            <div class="flex items-center justify-between gap-3 p-2 rounded-lg bg-gray-50 border border-gray-100 text-sm">
                <div class="flex items-start gap-2 overflow-hidden">
                    <div class="font-bold text-gray-700 whitespace-nowrap">@(item.Reporter?.UserName ?? "Unknown"):</div>
                    <div class="text-gray-600 italic truncate">
                        "@(item.Reason.Contains(":") ? item.Reason.Substring(item.Reason.IndexOf(":") + 1).Trim() : item.Reason)"
                    </div>
                </div>
                <span class="text-[10px] text-gray-400 whitespace-nowrap">@item.DateCreated.ToString("MMM dd")</span>
            </div>
        }

        @if (reportCount > 2)
        {
            <details class="group">
                <summary class="cursor-pointer text-xs font-bold text-blue-500 hover:text-blue-700 select-none list-none mb-2">
                    <span class="group-open:hidden"><i class="fas fa-chevron-down mr-1"></i> View @(reportCount - 2) more reports...</span>
                    <span class="hidden group-open:inline"><i class="fas fa-chevron-up mr-1"></i> Hide extra reports</span>
                </summary>
                <div class="flex flex-col gap-2 mt-2">
                    @foreach (var item in Group.Skip(2))
                    {
                        <div class="flex items-center justify-between gap-3 p-2 rounded-lg bg-gray-50 border border-gray-100 text-sm">
                            <div class="flex items-start gap-2 overflow-hidden">
                                <div class="font-bold text-gray-700 whitespace-nowrap">@(item.Reporter?.UserName ?? "Unknown"):</div>
                                <div class="text-gray-600 italic truncate">
                                    "@(item.Reason.Contains(":") ? item.Reason.Substring(item.Reason.IndexOf(":") + 1).Trim() : item.Reason)"
                                </div>
                            </div>
                            <span class="text-[10px] text-gray-400 whitespace-nowrap">@item.DateCreated.ToString("MMM dd")</span>
                        </div>
                    }
                </div>
            </details>
        }
    </div>
</div>

@code {
    [Parameter] public IGrouping<dynamic, Reports> Group { get; set; } = null!;
}
